
# NB: this file is executed within a mapped userns, so it can't do a proper
# job of fixing up things like ~/.ssh, which needs to really be owned by the
# uid that's going to run ssh.  See files/init.


# ---- prep settings

ACCOUNTS_DONT_DELETE_REGEX="^(root)"
GROUP_DONT_DELETE_REGEX="^(root)"
KMC_RM=0
ROOT_RM_HOMEDIR=0
SHELL_DISABLE_LOGIN=0
SBIN_DONT_DELETE_REGEX="nologin"
SYSDIRS_RM_REGEX="qweqwe"
WORLD_WRITABLE_DIRS_RM=0


# ---- system level fixups

# Fixup filenames that Makefile couldn't handle because of ":"'s
cd /etc/containers/certs.d
for x in *__*; do y=${x/__/:}; mv "$x" $"y"; done

# link /rw/dv/var_cache_apk to /var/cache/apk
[[ -L /rw/dv/var_cache_apk ]] || { mkdir -p /rw/dv; ln -s /var/cache/apk /rw/dv/var_cache_apk; }


# ---- private.d

# copy things out of private.d dirs
cp -f /root/.ssh/private.d/* /root/.ssh
