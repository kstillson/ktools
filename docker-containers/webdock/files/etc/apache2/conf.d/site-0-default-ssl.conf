LoadModule rewrite_module modules/mod_rewrite.so

<VirtualHost *:8443>

ServerAdmin tech@point0.net
DocumentRoot /var/www/html

SSLEngine on
SSLCertificateFile      /etc/apache2/keys/server.crt
SSLCertificateChainFile /etc/apache2/keys/server-chain.pem
SSLCertificateKeyFile   /etc/apache2/keys/server.key

ErrorLog logs/ssl_error.log
TransferLog logs/ssl_access.log
LogLevel warn

# Dont include port when redirecting from DirectorySlash
ServerName https://home.point0.net

ErrorDocument 401 "AuthN required"

############################################################
# Dir controls

<Directory />
    Options FollowSymLinks
    AllowOverride None
</Directory>
<Directory /var/www/html/>
    Options -Indexes
    Options FollowSymLinks MultiViews
    AllowOverride None
    Order allow,deny
    allow from all
</Directory>

############################################################
# Launchpad

RewriteEngine On
## for debugging: LogLevel alert rewrite:trace6
RewriteCond %{REMOTE_ADDR} ^192\.168\.
RewriteRule ^/$ /launchpad/index.html [R]

<Location /launchpad>
    AuthType Basic
    AuthName "homesec"
    AuthUserFile /etc/apache2/htpasswd.users
    <RequireAny>
        Require ip 192.168
        Require valid-user
    </RequireAny>
</Location>

############################################################
# CGI

ScriptAlias /cgi-bin/ /usr/lib/cgi-bin/
<Directory "/usr/lib/cgi-bin">
    AllowOverride None
    Options +ExecCGI -MultiViews +SymLinksIfOwnerMatch
    SSLOptions +StdEnvVars
    AuthType Basic
    AuthName "homesec"
    AuthUserFile /etc/apache2/htpasswd.users
    <RequireAny>
        Require ip 192.168
        Require valid-user
    </RequireAny>
</Directory>

BrowserMatch "MSIE [2-6]" \
    nokeepalive ssl-unclean-shutdown \
    downgrade-1.0 force-response-1.0
# MSIE 7 and newer should be able to use keepalive
BrowserMatch "MSIE [17-9]" ssl-unclean-shutdown


############################################################
# home control

<Location /hc>
    ProxyPass http://jack:3333
    AuthType Basic
    AuthName "homesec"
    AuthUserFile /etc/apache2/htpasswd.users
    <RequireAny>
        Require ip 192.168
        Require valid-user
    </RequireAny>
</Location>

<Location /control/>
    ProxyPass http://jack:3333/control/
    AuthType Basic
    AuthName "homesec"
    AuthUserFile /etc/apache2/htpasswd.users
    <RequireAny>
        Require ip 192.168
        Require valid-user
    </RequireAny>
</Location>

############################################################
# Homesec - NEW

<Location /homesec>
    ProxyPass "http://jack:1111"
    AuthType Basic
    AuthName "homesec"
    AuthUserFile /etc/apache2/htpasswd.users
    <RequireAny>
        Require ip 192.168
        Require valid-user
    </RequireAny>
</Location>


############################################################
# Homesec - old

#Alias /homesec000/static /home/ken/homesec/static
#<Directory /home/ken/homesec/>
#    AllowOverride None
#    Require all granted
#</Directory>
#<Directory /home/ken/homesec/static>
#    Order deny,allow
#</Directory>
#<Directory /usr/lib/python2.7/dist-packages/django/contrib/admin/static>
#    AllowOverride None
#    Require all granted
#</Directory>

#WSGIScriptAlias /homesec000 /home/ken/homesec/scripts/django.wsgi
#Alias /media /usr/lib/python2.7/dist-packages/django/contrib/admin/static
# Alias /homesec/admin/admin/css /usr/lib/python2.7/dist-packages/django/contrib/admin/static/admin/css

# WSGIScriptAlias /nestadj /home/ken/homesec/scripts/django.wsgi


############################################################
# proxies for rcam units

<Location /cam1>
    ProxyPass http://hs-family:8082/
    Order Deny,Allow
    Allow from all
    AuthName "homesec"
    AuthType Basic
    AuthUserFile /etc/apache2/htpasswd.users
    require valid-user
</Location>

<Location /cam2>
    ProxyPass http://hs-lounge:8082/
    Order Deny,Allow
    Allow from all
    AuthName "homesec"
    AuthType Basic
    AuthUserFile /etc/apache2/htpasswd.users
    require valid-user
</Location>

<Location /cam3>
    ProxyPass http://hs-front:8082/
    Order Deny,Allow
    Allow from all
    AuthName "homesec"
    AuthType Basic
    AuthUserFile /etc/apache2/htpasswd.users
    require valid-user
</Location>


############################################################
# procmon access

ProxyPass               "/procmon"      "http://jack:8080/"
ProxyPassReverse        "/procmon"      "http://jack:8080/"
<Location /procmon>
    Order Deny,Allow
    Allow from all
    AuthType Basic
    AuthName "homesec"
    AuthUserFile /etc/apache2/htpasswd.users
    require valid-user
</Location>


############################################################
# filewatch access

ProxyPass               "/fw"   "http://jack:8082/"
ProxyPassReverse        "/fw"   "http://jack:8082/"
<Location /fw>
    Order Deny,Allow
    Allow from all
    AuthType Basic
    AuthName "homesec"
    AuthUserFile /etc/apache2/htpasswd.users
    require valid-user
</Location>


############################################################
# speak command

ProxyPass               "/speak"   "http://pi1/speak/"
ProxyPassReverse        "/speak"   "http://pi1/speak/"
<Location /speak>
    Order Deny,Allow
    Allow from all
    AuthType Basic
    AuthName "homesec"
    AuthUserFile /etc/apache2/htpasswd.users
    require valid-user
</Location>


############################################################
# octopi access

ProxyPass               "/o/"   "http://octopi/"
ProxyPassReverse        "/o/"   "http://octopi/"
<Location /o>
    Order Deny,Allow
    Allow from all
    AuthType Basic
    AuthName "homesec"
    AuthUserFile /etc/apache2/htpasswd.users
    require valid-user
</Location>

############################################################
# https service redirects

Redirect        /map            https://home.point0.net/cgi-bin/map
Redirect        /mbs            https://groups.google.com/forum/#!forum/marions-memoirs

# script shorthands

ScriptAlias     /nh             /usr/lib/cgi-bin/nagios-healthz.cgi
ScriptAlias     /p1             /usr/lib/cgi-bin/party-on.cgi
ScriptAlias     /p0             /usr/lib/cgi-bin/party-off.cgi
ScriptAlias     /pf             /usr/lib/cgi-bin/party-fast.cgi

ScriptAliasMatch        "/rc/?$"        "/usr/lib/cgi-bin/rc"
<Location /rc>
  Allow from all
</Location>


############################################################

</VirtualHost>

# vim: syntax=apache ts=4 sw=4 sts=4 sr noet
