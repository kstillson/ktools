LoadModule rewrite_module modules/mod_rewrite.so

<VirtualHost *:8443>

ServerAdmin tech@point0.net
DocumentRoot /var/www/html

############################################################
# SSL controls

SSLEngine on
SSLCertificateFile      /etc/apache2/keys/server.crt
SSLCertificateChainFile /etc/apache2/keys/server-chain.pem
SSLCertificateKeyFile   /etc/apache2/keys/server.key

ErrorLog logs/ssl_error.log
TransferLog logs/ssl_access.log
LogLevel warn

# Dont include port when redirecting from DirectorySlash
ServerName https://home.point0.net

ErrorDocument 401 "AuthN required"

BrowserMatch "MSIE [2-6]" \
    nokeepalive ssl-unclean-shutdown \
    downgrade-1.0 force-response-1.0
# MSIE 7 and newer should be able to use keepalive
BrowserMatch "MSIE [17-9]" ssl-unclean-shutdown


############################################################
# Overall access controls

<Directory />
    Options FollowSymLinks
    AllowOverride None
</Directory>
<Directory /var/www/html/>
    Options -Indexes
    Options FollowSymLinks MultiViews
    AllowOverride None
    Order allow,deny
    allow from all
</Directory>


############################################################
# Public-facing simple redirects

Redirect        /map            https://home.point0.net/cgi-bin/map
Redirect        /mbs            https://groups.google.com/forum/#!forum/marions-memoirs


############################################################
# Launchpad

RewriteEngine On
## for debugging: LogLevel alert rewrite:trace6
RewriteCond %{REMOTE_ADDR} ^192\.168\.
RewriteRule ^/$ /launchpad/index.html [R]

<Location /launchpad>
    AuthType Basic
    AuthName "homesec"
    AuthUserFile /etc/apache2/htpasswd.users
    <RequireAny>
        Require ip 192.168
        Require valid-user
    </RequireAny>
</Location>


############################################################
# CGI

ScriptAlias /cgi-bin/ /usr/lib/cgi-bin/
<Directory "/usr/lib/cgi-bin">
    AllowOverride None
    Options +ExecCGI -MultiViews +SymLinksIfOwnerMatch
    SSLOptions +StdEnvVars
    AuthType Basic
    AuthName "homesec"
    AuthUserFile /etc/apache2/htpasswd.users
    <RequireAny>
        Require ip 192.168
        Require valid-user
    </RequireAny>
    <Files "nagios-healthz.cgi">
        Require all granted
    </Files>
    <Files "rc">
        Require all granted
    </Files>
</Directory>

ScriptAlias     /p1             /usr/lib/cgi-bin/party-on.cgi
ScriptAlias     /p0             /usr/lib/cgi-bin/party-off.cgi
ScriptAlias     /pf             /usr/lib/cgi-bin/party-fast.cgi

ScriptAliasMatch        "/rc/?$"        "/usr/lib/cgi-bin/rc"


############################################################
# home control

<Location /hc>
    ProxyPass http://jack:3333
    AuthType Basic
    AuthName "homesec"
    AuthUserFile /etc/apache2/htpasswd.users
    <RequireAny>
        Require ip 192.168
        Require valid-user
    </RequireAny>
</Location>

<Location /control/>
    ProxyPass http://jack:3333/control/
    AuthType Basic
    AuthName "homesec"
    AuthUserFile /etc/apache2/htpasswd.users
    <RequireAny>
        Require ip 192.168
        Require valid-user
    </RequireAny>
</Location>


############################################################
# Homesec

<Location /homesec>
    ProxyPass "http://jack:1111"
    AuthType Basic
    AuthName "homesec"
    AuthUserFile /etc/apache2/htpasswd.users
    <RequireAny>
        Require ip 192.168
        Require valid-user
    </RequireAny>
</Location>


############################################################
# Proxies for security cams

<Location /cam1>
    ProxyPass http://hs-family:8082/
    AuthType Basic
    AuthName "homesec"
    AuthUserFile /etc/apache2/htpasswd.users
    <RequireAny>
        Require ip 192.168
        Require valid-user
    </RequireAny>
</Location>

<Location /cam2>
    ProxyPass http://hs-lounge:8082/
    AuthType Basic
    AuthName "homesec"
    AuthUserFile /etc/apache2/htpasswd.users
    <RequireAny>
        Require ip 192.168
        Require valid-user
    </RequireAny>
</Location>

<Location /cam3>
    ProxyPass http://hs-front:8082/
    AuthType Basic
    AuthName "homesec"
    AuthUserFile /etc/apache2/htpasswd.users
    <RequireAny>
        Require ip 192.168
        Require valid-user
    </RequireAny>
</Location>


############################################################
# procmon access

<Location /procmon>
    ProxyPass "http://jack:8080"
    AuthType Basic
    AuthName "homesec"
    AuthUserFile /etc/apache2/htpasswd.users
    <RequireAny>
        Require ip 192.168
        Require valid-user
    </RequireAny>
</Location>


############################################################
# filewatch access

<Location /fw>
    ProxyPass "http://jack:8082/"
    AuthType Basic
    AuthName "homesec"
    AuthUserFile /etc/apache2/htpasswd.users
    <RequireAny>
        Require ip 192.168
        Require valid-user
    </RequireAny>
</Location>


############################################################
# speak command

<Location /speak>
    ProxyPass "http://pi1/speak/"
    AuthType Basic
    AuthName "homesec"
    AuthUserFile /etc/apache2/htpasswd.users
    <RequireAny>
        Require ip 192.168
        Require valid-user
    </RequireAny>
</Location>

############################################################

</VirtualHost>

# vim: syntax=apache ts=4 sw=4 sts=4 sr noet
